commands:
  00_install_ollama:
    command: |
      set -e
      # Skip if already installed
      if command -v ollama >/dev/null 2>&1; then
        echo "Ollama already installed"
        exit 0
      fi

      curl -fsSL https://ollama.com/install.sh | sh

  01_enable_service:
    command: |
      set -e
      # The install script drops a systemd unit called 'ollama'
      systemctl daemon-reload
      systemctl enable ollama
      systemctl restart ollama

files:
  "/etc/profile.d/ollama.sh":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Change bind address/port if you want it reachable externally
      export OLLAMA_HOST=0.0.0.0:11434

container_commands:
  10_export_env:
    command: |
      echo "OLLAMA_HOST=${OLLAMA_HOST:-0.0.0.0:11434}" >> /opt/elasticbeanstalk/deployment/env
